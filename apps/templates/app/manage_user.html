{% extends 'app/base.html' %}
{% load static %}

{% block manage_user %}
<div class="container mt-4">
    <h2 class="mb-4">Quản lý tài khoản khách hàng</h2>

    <!-- Hiển thị thông báo -->
    {% if messages %}
    <div class="mb-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <script>
    // Tự động đóng alert sau 5 giây (5000ms)
    setTimeout(function() {
        document.querySelectorAll('.auto-dismiss').forEach(function(el) {
            el.classList.remove('show'); // ẩn bằng bootstrap
        });
    }, 5000);
    </script>

    <table class="table table-striped table-hover align-middle">
        <thead class="table-dark">
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Tên đăng nhập</th>
                <th scope="col">Email</th>
                <th scope="col">Tên</th>
                <th scope="col">Ngày tạo</th>
                <th scope="col">Trạng thái</th>
                <th scope="col">Hành động</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.first_name }} {{ u.last_name }}</td>
                <td>{{ u.date_joined|date:"d/m/Y H:i" }}</td>
                <td>
                    {% if u.is_active %}
                        <span class="badge bg-success">Hoạt động</span>
                    {% else %}
                        <span class="badge bg-danger">Khóa</span>
                    {% endif %}
                </td>
                <td>
                    <!-- Khóa / Mở khóa -->
                    <a href="{% url 'toggle_user_status' u.id %}"
                       class="btn btn-sm {% if u.is_active %}btn-warning{% else %}btn-success{% endif %}">
                       {% if u.is_active %}Khóa{% else %}Mở khóa{% endif %}
                    </a>

                    <!-- Sửa -->
                    <a href="{% url 'admin:auth_user_change' u.id %}" class="btn btn-sm btn-primary">
                        Sửa
                    </a>

                    <!-- Xóa -->
                    <a href="{% url 'admin:auth_user_delete' u.id %}"
                       class="btn btn-sm btn-danger"
                       onclick="return confirm('Bạn có chắc muốn xóa tài khoản {{ u.username }}?');">
                       Xóa
                    </a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">Không có tài khoản nào</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
